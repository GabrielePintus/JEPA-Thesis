trainer:
  max_epochs: 100
  accelerator: gpu
  devices: 1
  num_nodes: 1
  strategy: ddp_find_unused_parameters_false
  precision: bf16-mixed
  gradient_clip_val: 1.0
  gradient_clip_algorithm: norm
  accumulate_grad_batches: 2
  callbacks:
  - class_path: lightning.pytorch.callbacks.ModelCheckpoint
    init_args:
      dirpath: checkpoints/jepa_isometric
      filename: "JEPA-ISO-{epoch:03d}-{val/jepa_loss:.4f}-{val/value_loss:.4f}"
      monitor: val/loss  # Monitor total loss now
      mode: min
      save_top_k: 1
      save_last: true
      auto_insert_metric_name: false
      every_n_epochs: 1
      save_on_train_epoch_end: true
  logger:
    class_path: lightning.pytorch.loggers.WandbLogger
    init_args:
      project: "JEPA-Isometric"
      name: "PointMaze/JEPA-IsometricValue"
      log_model: true

model:
  # ============================================================================
  # Architecture
  # ============================================================================
  emb_dim: 128

  # ============================================================================
  # JEPA Loss Coefficients (unchanged from your config)
  # ============================================================================
  var_coeff: 15.0
  cov_coeff: 1.0
  smooth_coeff: 0.0
  idm_coeff: 1.0
  tvcreg_coeff: 1.0
  prediction_cost_discount: 0.95
  isometry_coeff: 0.0

  # ============================================================================
  # Value Function (NEW - Only 5 parameters!)
  # ============================================================================
  value_coeff: 1.0                   # Weight of value loss (start with 1.0)
  value_gamma: 0.99                  # Discount factor
  value_tau: 0.005                   # Target network update rate
  value_hindsight_ratio: 0.8         # Hindsight relabeling (80%)
  value_update_freq: 2               # Update target every 2 steps

  # ============================================================================
  # JEPA Optimization (unchanged from your config)
  # ============================================================================
  initial_lr_encoder: 2e-3
  final_lr_encoder: 1e-6
  weight_decay_encoder: 1e-5
  initial_lr_decoder: 1e-3
  final_lr_decoder: 1e-5
  weight_decay_decoder: 0.0
  initial_lr_predictor: 1e-3
  final_lr_predictor: 1e-6
  weight_decay_predictor: 1e-5
  warmup_steps: 1000

  # ============================================================================
  # Value Function Optimization (NEW)
  # ============================================================================
  initial_lr_value: 3e-4             # Lower than encoder (important!)
  final_lr_value: 1e-5
  weight_decay_value: 1e-4

  # ============================================================================
  # Misc
  # ============================================================================
  compile: false

# ============================================================================
# Data (unchanged)
# ============================================================================
data:
  data_path: data/train_trajectories_1000_100_4_64_largerdot.npz
  batch_size: 64
  num_workers: 2
  pin_memory: true
  val_size: 0.1
  seq_len: 10
  stride: 10
  normalize: false